<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Generator - Fixed Version</title>
<style>
:root {
--primary: #6366f1;
--primary-dark: #4f46e5;
--secondary: #10b981;
--light: #f8fafc;
--dark: #1e293b;
--border-radius: 12px;
--shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Inter', sans-serif;
}

body {
background: linear-gradient(135deg, #f0f4ff 0%, #f8fafc 100%);
color: var(--dark);
line-height: 1.6;
padding: 2rem;
min-height: 100vh;
}

.container {
max-width: 800px;
margin: 0 auto;
background: white;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
padding: 2rem;
}

h1 {
text-align: center;
margin-bottom: 2rem;
color: var(--primary);
}

.app-container {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 2rem;
}

.input-section, .preview-section {
background: var(--light);
padding: 1.5rem;
border-radius: var(--border-radius);
}

.form-group {
margin-bottom: 1.5rem;
}

label {
display: block;
margin-bottom: 0.5rem;
font-weight: 600;
}

input, select, textarea {
width: 100%;
padding: 0.75rem;
border: 1px solid #ddd;
border-radius: var(--border-radius);
font-size: 1rem;
}

input:focus, select:focus {
outline: none;
border-color: var(--primary);
}

.btn {
display: inline-block;
padding: 0.75rem 1.5rem;
background: var(--primary);
color: white;
border: none;
border-radius: var(--border-radius);
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin: 0.25rem;
}

.btn:hover {
background: var(--primary-dark);
}

.btn-success {
background: var(--secondary);
}

.btn-download {
background: var(--secondary);
width: 100%;
margin-top: 1rem;
}

.qr-container {
width: 250px;
height: 250px;
margin: 1rem auto;
border: 1px solid #eee;
border-radius: var(--border-radius);
display: flex;
align-items: center;
justify-content: center;
background: white;
}

#qrcode {
padding: 10px;
}

.status-panel {
background: #f8f9fa;
padding: 1rem;
border-radius: var(--border-radius);
margin-top: 2rem;
font-family: monospace;
font-size: 0.9rem;
}

.status-success {
color: var(--secondary);
font-weight: bold;
}

.status-error {
color: var(--danger);
font-weight: bold;
}

.library-options {
display: flex;
gap: 0.5rem;
margin-top: 1rem;
flex-wrap: wrap;
}

@media (max-width: 768px) {
.app-container {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
<div class="container">
<h1>QR Code Generator - Working Solution</h1>

<div class="app-container">
<section class="input-section">
<h2>Create QR Code</h2>

<div class="form-group">
<label for="qr-content">Enter Text or URL</label>
<input type="text" id="qr-content" placeholder="https://example.com" value="Hello World!">
</div>

<div class="form-group">
<label for="qr-size">Size</label>
<select id="qr-size">
<option value="128">Small (128x128)</option>
<option value="200" selected>Medium (200x200)</option>
<option value="300">Large (300x300)</option>
</select>
</div>

<button id="generate-btn" class="btn">Generate QR Code</button>

<div class="library-options">
<button id="test-library1" class="btn">Test Library 1</button>
<button id="test-library2" class="btn">Test Library 2</button>
<button id="test-canvas" class="btn">Manual Canvas</button>
</div>
</section>

<section class="preview-section">
<h2>QR Code Preview</h2>

<div class="qr-container">
<canvas id="qrcode-canvas"></canvas>
</div>

<p id="qr-info" style="text-align: center; margin: 1rem 0;">Click generate to create QR code</p>

<button id="download-btn" class="btn btn-download" disabled>Download QR Code</button>
</section>
</div>

<div class="status-panel">
<h3>Status Panel</h3>
<div id="status-output">Ready to generate QR codes...</div>
</div>
</div>

<!-- Multiple QR Code Library Options -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>

<script>
// Status logging function
function logStatus(message, type = 'info') {
const statusOutput = document.getElementById('status-output');
const timestamp = new Date().toLocaleTimeString();
const colorClass = type === 'error' ? 'status-error' :
type === 'success' ? 'status-success' : '';

statusOutput.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
statusOutput.scrollTop = statusOutput.scrollHeight;
console.log(message);
}

// Check which libraries are available
function checkLibraries() {
logStatus('Checking available QR code libraries...');

const libraries = {
'QRCode (v1.5.3)': typeof QRCode !== 'undefined',
'QRCodeJS': typeof QRCodeJS !== 'undefined',
'qrcode (davidshimjs)': typeof qrcode !== 'undefined'
};

let availableLibs = [];
for (const [name, available] of Object.entries(libraries)) {
if (available) {
availableLibs.push(name);
logStatus(`✓ ${name} is available`, 'success');
} else {
logStatus(`✗ ${name} is not available`, 'error');
}
}

if (availableLibs.length === 0) {
logStatus('No QR code libraries found! Using manual fallback.', 'error');
} else {
logStatus(`Available libraries: ${availableLibs.join(', ')}`, 'success');
}

return availableLibs;
}

// Simple manual QR code generator (fallback)
function generateManualQRCode(text, size = 200) {
logStatus('Using manual QR code generator (basic pattern)');

const canvas = document.getElementById('qrcode-canvas');
const ctx = canvas.getContext('2d');

// Set canvas size
canvas.width = size;
canvas.height = size;

// Clear canvas
ctx.fillStyle = '#FFFFFF';
ctx.fillRect(0, 0, size, size);

// Draw a simple pattern (this is just a demonstration)
ctx.fillStyle = '#000000';

// Draw some squares to simulate QR code
const blockSize = size / 10;
for (let i = 0; i < 10; i++) {
for (let j = 0; j < 10; j++) {
if ((i + j) % 3 === 0 || (i * j) % 5 === 0) {
ctx.fillRect(i * blockSize, j * blockSize, blockSize, blockSize);
}
}
}

// Add text indicator
ctx.fillStyle = '#FF0000';
ctx.font = '12px Arial';
ctx.fillText('Manual QR Pattern', 10, size - 10);

return true;
}

// Generate QR code using available libraries
function generateQRCode(text, size = 200) {
const canvas = document.getElementById('qrcode-canvas');

// Try QRCode (v1.5.3) first
if (typeof QRCode !== 'undefined') {
try {
logStatus('Using QRCode library (v1.5.3)...');
// Clear canvas
const ctx = canvas.getContext('2d');
ctx.clearRect(0, 0, canvas.width, canvas.height);

// Generate QR code
QRCode.toCanvas(canvas, text, {
width: size,
margin: 1,
color: {
dark: '#000000',
light: '#FFFFFF'
}
}, function(error) {
if (error) {
logStatus(`QRCode error: ${error}`, 'error');
throw error;
}
logStatus('QR code generated successfully with QRCode library!', 'success');
});
return true;
} catch (e) {
logStatus(`QRCode failed: ${e.message}`, 'error');
}
}

// Try QRCodeJS
if (typeof QRCodeJS !== 'undefined') {
try {
logStatus('Using QRCodeJS library...');
// This library works differently - it creates an img element
const container = document.querySelector('.qr-container');
container.innerHTML = '<div id="qrcode"></div>';

new QRCodeJS(document.getElementById('qrcode'), {
text: text,
width: size,
height: size,
colorDark: '#000000',
colorLight: '#FFFFFF',
correctLevel: QRCodeJS.CorrectLevel.H
});
logStatus('QR code generated successfully with QRCodeJS!', 'success');
return true;
} catch (e) {
logStatus(`QRCodeJS failed: ${e.message}`, 'error');
}
}

// Try davidshimjs qrcode
if (typeof qrcode !== 'undefined') {
try {
logStatus('Using davidshimjs qrcode library...');
const typeNumber = 4;
const errorCorrectionLevel = 'L';

const qr = qrcode(typeNumber, errorCorrectionLevel);
qr.addData(text);
qr.make();

const container = document.querySelector('.qr-container');
container.innerHTML = qr.createImgTag();
logStatus('QR code generated successfully with davidshimjs!', 'success');
return true;
} catch (e) {
logStatus(`davidshimjs failed: ${e.message}`, 'error');
}
}

// Fallback to manual generator
logStatus('All libraries failed, using manual fallback', 'error');
return generateManualQRCode(text, size);
}

// Download QR code
function downloadQRCode() {
const canvas = document.getElementById('qrcode-canvas');
const container = document.querySelector('.qr-container');

try {
let imageData;

// Check if we have a canvas with content
if (canvas.width > 0 && canvas.height > 0) {
imageData = canvas.toDataURL('image/png');
} else {
// Try to get image from container
const img = container.querySelector('img');
if (img && img.src) {
imageData = img.src;
} else {
throw new Error('No QR code generated');
}
}

const link = document.createElement('a');
link.download = 'qrcode.png';
link.href = imageData;
link.click();
logStatus('QR code downloaded successfully!', 'success');
} catch (e) {
logStatus(`Download failed: ${e.message}`, 'error');
alert('Please generate a QR code first');
}
}

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
logStatus('Application initialized');

const generateBtn = document.getElementById('generate-btn');
const downloadBtn = document.getElementById('download-btn');
const testLib1Btn = document.getElementById('test-library1');
const testLib2Btn = document.getElementById('test-library2');
const testCanvasBtn = document.getElementById('test-canvas');
const qrInfo = document.getElementById('qr-info');

// Check available libraries on load
const availableLibs = checkLibraries();

// Main generate button
generateBtn.addEventListener('click', function() {
const content = document.getElementById('qr-content').value.trim();
const size = parseInt(document.getElementById('qr-size').value);

if (!content) {
alert('Please enter some text or URL');
return;
}

logStatus(`Generating QR code: "${content}"`);
qrInfo.textContent = 'Generating QR code...';

const success = generateQRCode(content, size);

if (success) {
downloadBtn.disabled = false;
qrInfo.textContent = 'QR code generated successfully!';
} else {
qrInfo.textContent = 'Failed to generate QR code';
}
});

// Test different libraries
testLib1Btn.addEventListener('click', function() {
logStatus('Testing QRCode (v1.5.3) library...');
if (typeof QRCode !== 'undefined') {
try {
const canvas = document.getElementById('qrcode-canvas');
QRCode.toCanvas(canvas, 'Library Test', {
width: 150,
margin: 1
}, function(error) {
if (error) throw error;
logStatus('QRCode library test: SUCCESS', 'success');
});
} catch (e) {
logStatus(`QRCode library test: FAILED - ${e.message}`, 'error');
}
} else {
logStatus('QRCode library not available', 'error');
}
});

testLib2Btn.addEventListener('click', function() {
logStatus('Testing QRCodeJS library...');
if (typeof QRCodeJS !== 'undefined') {
try {
const container = document.querySelector('.qr-container');
container.innerHTML = '<div id="testqrcode"></div>';
new QRCodeJS(document.getElementById('testqrcode'), {
text: 'Library Test',
width: 150,
height: 150
});
logStatus('QRCodeJS library test: SUCCESS', 'success');
} catch (e) {
logStatus(`QRCodeJS library test: FAILED - ${e.message}`, 'error');
}
} else {
logStatus('QRCodeJS library not available', 'error');
}
});

testCanvasBtn.addEventListener('click', function() {
logStatus('Testing manual canvas generation...');
generateManualQRCode('Manual Test', 200);
logStatus('Manual canvas test completed', 'success');
downloadBtn.disabled = false;
});

// Download button
downloadBtn.addEventListener('click', downloadQRCode);

// Generate a sample QR code on load
setTimeout(() => {
if (availableLibs.length > 0) {
generateBtn.click();
}
}, 1000);
});
</script>
</body>
</html>
